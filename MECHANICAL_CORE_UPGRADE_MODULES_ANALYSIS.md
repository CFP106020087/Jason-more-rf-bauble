# æœºæ¢°æ ¸å¿ƒå‡çº§æ¨¡å—ç³»ç»Ÿå…¨é¢åˆ†æ

> **åˆ†ææ—¥æœŸ**: 2025-01-22
> **ç›®æ ‡**: åˆ†æ ItemMechanicalCore åŠç›¸å…³å‡çº§æ¨¡å—çš„æ•°æ®ç»“æ„ã€NBTå­—æ®µã€è€¦åˆå…³ç³»

---

## ğŸ“Š ä¸€ã€æ‰€æœ‰å‡çº§æ¨¡å—åˆ—è¡¨

###  1.1 åŸºç¡€å‡çº§ (ItemMechanicalCore.UpgradeType)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² | ä½ç½® | æœ€å¤§ç­‰çº§ |
|--------|----------|------|------|----------|
| `ENERGY_CAPACITY` | èƒ½é‡å®¹é‡ | GOLD | ItemMechanicalCore | åŠ¨æ€ |
| `ENERGY_EFFICIENCY` | èƒ½é‡æ•ˆç‡ | GREEN | ItemMechanicalCore | åŠ¨æ€ |
| `ARMOR_ENHANCEMENT` | æŠ¤ç”²å¼ºåŒ– | BLUE | ItemMechanicalCore | åŠ¨æ€ |
| `SPEED_BOOST` | é€Ÿåº¦æå‡ | AQUA | ItemMechanicalCore | åŠ¨æ€ |
| `REGENERATION` | ç”Ÿå‘½æ¢å¤ | RED | ItemMechanicalCore | åŠ¨æ€ |
| `FLIGHT_MODULE` | é£è¡Œæ¨¡å— | LIGHT_PURPLE | ItemMechanicalCore | åŠ¨æ€ |
| `SHIELD_GENERATOR` | æŠ¤ç›¾å‘ç”Ÿå™¨ | GOLD | ItemMechanicalCore | åŠ¨æ€ |
| `TEMPERATURE_CONTROL` | æ¸©åº¦è°ƒèŠ‚ | DARK_AQUA | ItemMechanicalCore | åŠ¨æ€ |

### 1.2 ç”Ÿå­˜ç±»å‡çº§ (ItemMechanicalCoreExtended)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² | æœ€å¤§ç­‰çº§ | NBTå‰ç¼€ |
|--------|----------|------|----------|---------|
| `YELLOW_SHIELD` | é»„æ¡æŠ¤ç›¾ | YELLOW | 3 | YELLOW_SHIELD |
| `HEALTH_REGEN` | çº³ç±³ä¿®å¤ | RED | 3 | HEALTH_REGEN |
| `HUNGER_THIRST` | ä»£è°¢è°ƒèŠ‚ | GREEN | 3 | HUNGER_THIRST |
| `THORNS` | ååº”è£…ç”² | DARK_RED | 3 | THORNS |
| `FIRE_EXTINGUISH` | è‡ªåŠ¨ç­ç« | BLUE | 3 | FIRE_EXTINGUISH |

### 1.3 è¾…åŠ©ç±»å‡çº§ (ItemMechanicalCoreExtended)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² | æœ€å¤§ç­‰çº§ | åˆ«å |
|--------|----------|------|----------|------|
| `WATERPROOF_MODULE` | é˜²æ°´æ¨¡å— | AQUA | 3 | waterproof, waterproof_module |
| `ORE_VISION` | çŸ¿ç‰©é€è§† | GOLD | 3 | - |
| `MOVEMENT_SPEED` | ä¼ºæœç”µæœº | AQUA | 3 | - |
| `STEALTH` | å…‰å­¦è¿·å½© | DARK_GRAY | 3 | - |
| `EXP_AMPLIFIER` | ç»éªŒçŸ©é˜µ | GREEN | 3 | - |
| `POISON_IMMUNITY` | æ¯’å…ç–« | DARK_GREEN | 1 | - |
| `NIGHT_VISION` | å¤œè§† | YELLOW | 1 | - |
| `WATER_BREATHING` | æ°´ä¸‹å‘¼å¸ | AQUA | 1 | - |
| `ITEM_MAGNET` | ç‰©å“ç£é“ | LIGHT_PURPLE | 3 | - |
| `NEURAL_SYNCHRONIZER` | ç¥ç»åŒæ­¥å™¨ | AQUA | 1 | - |

### 1.4 æˆ˜æ–—ç±»å‡çº§ (ItemMechanicalCoreExtended)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² | æœ€å¤§ç­‰çº§ |
|--------|----------|------|----------|
| `DAMAGE_BOOST` | åŠ›é‡å¢å¹… | DARK_RED | 5 |
| `ATTACK_SPEED` | ååº”å¢å¼º | YELLOW | 3 |
| `RANGE_EXTENSION` | èŒƒå›´æ‹“å±• | BLUE | 3 |
| `PURSUIT` | è¿½å‡»ç³»ç»Ÿ | LIGHT_PURPLE | 3 |
| `CRITICAL_STRIKE` | æš´å‡»ç³»ç»Ÿ | RED | 3 |
| `MAGIC_ABSORB` | é­”åŠ›ç†”ç‚‰ | AQUA | 3 |
| `LOOTING_MODULE` | æ å¤ºå¢å¹… | GOLD | 3 |

### 1.5 èƒ½æºç±»å‡çº§ (ItemMechanicalCoreExtended)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² | æœ€å¤§ç­‰çº§ |
|--------|----------|------|----------|
| `KINETIC_GENERATOR` | åŠ¨èƒ½å‘ç”µ | GRAY | 3 |
| `SOLAR_GENERATOR` | å¤ªé˜³èƒ½å‘ç”µ | YELLOW | 3 |
| `VOID_ENERGY` | è™šç©ºèƒ½é‡ | DARK_PURPLE | 3 |
| `COMBAT_CHARGER` | æˆ˜æ–—å……èƒ½ | RED | 3 |

### 1.6 å¥—è£…ç±»å‡çº§ (UpgradeType.java)

| æ¨¡å—ID | æ˜¾ç¤ºåç§° | é¢œè‰² |
|--------|----------|------|
| `SURVIVAL_PACKAGE` | ç”Ÿå­˜å¼ºåŒ–å¥—è£… | DARK_GREEN |
| `COMBAT_PACKAGE` | æˆ˜æ–—å¼ºåŒ–å¥—è£… | DARK_RED |
| `OMNIPOTENT_PACKAGE` | å…¨èƒ½å¥—è£… | LIGHT_PURPLE |

**æ€»è®¡**: çº¦ **30+** ä¸ªç‹¬ç«‹å‡çº§æ¨¡å—

---

## ğŸ—‚ï¸ äºŒã€NBT æ•°æ®ç»“æ„å®Œæ•´æ˜ å°„

### 2.1 æ ¸å¿ƒå­—æ®µæ¨¡å¼

#### A. ç­‰çº§å­˜å‚¨
```
upgrade_<moduleId> : int
```
**ç¤ºä¾‹**:
- `upgrade_ENERGY_CAPACITY` = 10
- `upgrade_energy_capacity` = 10  (å°å†™å…¼å®¹)
- `upgrade_FLIGHT_MODULE` = 3

#### B. å®‰è£…æ ‡è®°
```
HasUpgrade_<moduleId> : boolean
```
**ç”¨é€”**: æ ‡è®°æ›¾ç»å®‰è£…è¿‡ï¼Œå³ä½¿ç­‰çº§ä¸º0
**ç¤ºä¾‹**:
- `HasUpgrade_FLIGHT_MODULE` = true

#### C. æ‹¥æœ‰ç­‰çº§ä¸Šé™
```
OwnedMax_<moduleId> : int
```
**ç”¨é€”**: è®°å½•ç©å®¶æ‹¥æœ‰çš„æœ€é«˜ç­‰çº§ï¼ˆç”¨äºé˜²æ­¢é™çº§ä½œå¼Šï¼‰
**ç¤ºä¾‹**:
- `OwnedMax_DAMAGE_BOOST` = 5
- `OwnedMax_damage_boost` = 5  (å¤§å°å†™å…¼å®¹)

#### D. ç¦ç”¨/æš‚åœæ ‡è®°
```
Disabled_<moduleId> : boolean
IsPaused_<moduleId> : boolean
```
**ç”¨é€”**: GUIæ§åˆ¶å‡çº§å¼€å…³
**ç¤ºä¾‹**:
- `Disabled_ORE_VISION` = true
- `IsPaused_WATERPROOF_MODULE` = true

#### E. æƒ©ç½šç³»ç»Ÿå­—æ®µ
```
PenaltyExpire_<moduleId> : long     # æƒ©ç½šåˆ°æœŸæ—¶é—´æˆ³
PenaltyCap_<moduleId> : int         # æƒ©ç½šä¸Šé™
PenaltyTier_<moduleId> : int        # æƒ©ç½šç­‰çº§
PenaltyDebtFE_<moduleId> : int      # èƒ½é‡å€ºåŠ¡
PenaltyDebtXP_<moduleId> : int      # ç»éªŒå€ºåŠ¡
```
**ç”¨é€”**: æ¨¡å—æ»¥ç”¨æƒ©ç½šæœºåˆ¶

#### F. é£è¡Œæ¨¡å—ä¸“ç”¨å­—æ®µ
```
FlightModuleEnabled : boolean        # é£è¡Œæ¨¡å—æ€»å¼€å…³
FlightHoverMode : boolean            # æ‚¬åœæ¨¡å¼
```

#### G. èƒ½é‡ç³»ç»Ÿå­—æ®µ
```
Energy : int                         # å½“å‰èƒ½é‡
TotalEnergySaved : long              # ç´¯è®¡èŠ‚èƒ½é‡
SessionEnergySaved : int             # æœ¬æ¬¡ä¼šè¯èŠ‚èƒ½é‡
EmergencyMode : boolean              # ç´§æ€¥çœç”µæ¨¡å¼
```

#### H. é€Ÿåº¦æ¨¡å¼
```
CoreSpeedMode : int                  # 0=Normal, 1=Fast, 2=Ultra
```

#### I. æ½®æ¹¿å€¼ç³»ç»Ÿ (WetnessSystem)
```
MechanicalCore.Wetness : int         # æ½®æ¹¿å€¼ (0-100)
MechanicalCore.WetnessLastTick : long
```

### 2.2 NBTå­—æ®µå‘½åå†²çªé—®é¢˜

âš ï¸ **å‘ç°çš„é—®é¢˜**:
1. **å¤§å°å†™ä¸ç»Ÿä¸€**: åŒä¸€æ¨¡å—æœ‰ `upgrade_FLIGHT_MODULE` å’Œ `upgrade_flight_module`
2. **åˆ«åå†—ä½™**: WATERPROOF æœ‰4ä¸ªåˆ«åéƒ½ä¼šå†™å…¥NBT
3. **å‰ç¼€ä¸ç»Ÿä¸€**: æœ‰ `MechanicalCore.`ã€`moremod.module.` ç­‰å¤šç§å‰ç¼€

---

## ğŸ“ ä¸‰ã€NBT è¯»å†™ä½ç½®æ˜ å°„

### 3.1 ä¸»è¦è¯»å†™ç±»

| ç±»å | èŒè´£ | è¯»å†™å­—æ®µ |
|------|------|----------|
| `ItemMechanicalCore` | æ ¸å¿ƒç‰©å“ç±» | æ‰€æœ‰åŸºç¡€å‡çº§å­—æ®µ |
| `ItemMechanicalCoreExtended` | æ‰©å±•å‡çº§ç®¡ç† | æ‰©å±•å‡çº§å­—æ®µ |
| `MechanicalCoreGui` | GUIç•Œé¢ | Disabled_*, IsPaused_* |
| `PacketMechanicalCoreUpdate` | ç½‘ç»œåŒæ­¥ | upgrade_*, Disabled_* |
| `WaterproofUpgrade` | é˜²æ°´é€»è¾‘ | WATERPROOFç›¸å…³ |
| `WetnessSystem` | æ½®æ¹¿å€¼ç³»ç»Ÿ | Wetnesså­—æ®µ |
| `TemperatureControlEffect` | æ¸©åº¦æ§åˆ¶ | TEMPERATURE_CONTROL |
| `MechanicalCoreFlightHandler` | é£è¡Œå¤„ç† | FlightModuleEnabled, FlightHoverMode |
| `EnergyDepletionManager` | èƒ½é‡è€—å°½ç®¡ç† | EmergencyMode |
| `EnergyUpgradeManager` | èƒ½æºå‡çº§ | LastPosX/Y/Z, KineticBufferç­‰ |

### 3.2 è¯»å–ä½ç½®ç»Ÿè®¡

```java
// ä¸»è¦è¯»å–æ–¹æ³•è°ƒç”¨æ¬¡æ•°ï¼ˆä¼°ç®—ï¼‰
getUpgradeLevel()      : ~200+ æ¬¡è°ƒç”¨
isUpgradeActive()      : ~150+ æ¬¡è°ƒç”¨
getEffectiveUpgradeLevel() : ~100+ æ¬¡è°ƒç”¨
```

### 3.3 å†™å…¥ä½ç½®ç»Ÿè®¡

```java
// ä¸»è¦å†™å…¥æ–¹æ³•
setUpgradeLevel()          : ~50+ æ¬¡
setUpgradeLevelSafe()      : ~30+ æ¬¡
nbt.setInteger("upgrade_*"): åˆ†æ•£åœ¨å¤šä¸ªç±»ä¸­
```

---

## ğŸ”— å››ã€æ¨¡å—é—´è€¦åˆå…³ç³»

### 4.1 å¼ºè€¦åˆå…³ç³»

#### A. é£è¡Œæ¨¡å— â†’ äº‹ä»¶ç³»ç»Ÿ
```
MechanicalCoreFlightHandler â†’ EventHandlerJetpack
  - è¯»å–: jetpackJumping, jetpackSneaking
  - å†™å…¥: playerFlying, jetpackActivelyUsed
```
**é—®é¢˜**: é£è¡Œé€»è¾‘åˆ†æ•£åœ¨ä¸¤ä¸ªç±»ä¸­

#### B. èƒ½é‡æ•ˆç‡ â†’ æ‰€æœ‰æ¨¡å—
```
ItemMechanicalCore.calculateActualEnergyCost()
  â†’ è¢«æ‰€æœ‰consumeEnergyè°ƒç”¨
```
**å½±å“**: èƒ½é‡æ•ˆç‡æ¨¡å—å½±å“æ‰€æœ‰å…¶ä»–æ¨¡å—

#### C. é˜²æ°´æ¨¡å— â†’ æ½®æ¹¿å€¼ç³»ç»Ÿ
```
WaterproofUpgrade â†’ WetnessSystem
```

#### D. æŠ¤ç›¾æ¨¡å— â†’ å¸æ”¶å¿ƒç³»ç»Ÿ
```
SurvivalUpgradeManager.YellowShieldSystem
  â†’ EntityPlayer.setAbsorptionAmount()
```
**é—®é¢˜**: ç›´æ¥æ“ä½œç©å®¶å±æ€§

### 4.2 ä¸­ç­‰è€¦åˆ

| æ¨¡å—A | æ¨¡å—B | å…³ç³» |
|-------|-------|------|
| ENERGY_EFFICIENCY | SPEED_BOOST | å…±äº«èƒ½é‡æ¶ˆè€—è®¡ç®— |
| KINETIC_GENERATOR | MOVEMENT_SPEED | ç§»åŠ¨æ£€æµ‹å¤ç”¨ |
| ORE_VISION | STEALTH | éƒ½ä¿®æ”¹ç©å®¶å¯è§æ€§ |
| DAMAGE_BOOST | CRITICAL_STRIKE | éƒ½ä¿®æ”¹ä¼¤å®³è®¡ç®— |

### 4.3 æ•°æ®ä¾èµ–

```
[ENERGY_CAPACITY]
  â†“ (å½±å“)
[ENERGY_EFFICIENCY] â†’ [æ‰€æœ‰ä¸»åŠ¨æ¨¡å—]
  â†“
[è¢«åŠ¨æ¶ˆè€—è®¡ç®—] â† [ç”µæ± ç³»ç»Ÿ]
```

---

## ğŸ¯ äº”ã€åº”è¿ç§»åˆ° Capability çš„å­—æ®µ

### 5.1 é«˜ä¼˜å…ˆçº§ï¼ˆåº”è¯¥ç«‹å³è¿ç§»ï¼‰

#### A. ç©å®¶çŠ¶æ€å­—æ®µ
**å½“å‰ä½ç½®**: EntityPlayer.getEntityData()
**åº”è¯¥æ”¾åœ¨**: IPlayerModuleCapability

```java
// è¿™äº›å­—æ®µåº”è¯¥ä»NBTç§»åˆ°Capability
- LastPosX/Y/Z                    // åŠ¨èƒ½å‘ç”µä½ç½®è¿½è¸ª
- KineticBuffer                   // åŠ¨èƒ½ç¼“å†²
- SolarLastTick                   // å¤ªé˜³èƒ½ä¸Šæ¬¡tick
- VoidCharge                      // è™šç©ºå……èƒ½
- CombatLastKillTick              // æˆ˜æ–—å……èƒ½æ—¶é—´

- MechanicalCoreLastAttack        // æ”»å‡»é€Ÿåº¦è¿½è¸ª
- MechanicalCoreSpeedApplied      // é€Ÿåº¦åº”ç”¨æ ‡è®°
- MechanicalCoreShieldCooldown    // æŠ¤ç›¾å†·å´
- MechanicalCoreShieldLastUpdate  // æŠ¤ç›¾æ›´æ–°æ—¶é—´
- MechanicalCoreShieldActive      // æŠ¤ç›¾æ¿€æ´»çŠ¶æ€
```

#### B. ä¸´æ—¶è¿è¡Œæ—¶æ•°æ®
**ä¸åº”è¯¥æŒä¹…åŒ–åˆ°NBT**

```java
// è¿™äº›æ˜¯ä¸´æ—¶çŠ¶æ€ï¼Œåº”è¯¥åªåœ¨å†…å­˜ä¸­
- EmergencyMode          // ç´§æ€¥æ¨¡å¼ï¼ˆè¿è¡Œæ—¶çŠ¶æ€ï¼‰
- SessionEnergySaved     // ä¼šè¯èŠ‚èƒ½ï¼ˆä¸´æ—¶ç»Ÿè®¡ï¼‰
- IsPaused_*             // GUIæš‚åœçŠ¶æ€ï¼ˆä¸´æ—¶ï¼‰
```

### 5.2 ä¸­ä¼˜å…ˆçº§

#### C. æ¨¡å—é…ç½®å­—æ®µ
**å¯ä»¥è€ƒè™‘è¿ç§»åˆ°Capability**

```java
- FlightModuleEnabled    // é£è¡Œå¼€å…³
- FlightHoverMode        // æ‚¬åœæ¨¡å¼
- CoreSpeedMode          // é€Ÿåº¦æ¨¡å¼
```

**ç†ç”±**: è¿™äº›æ˜¯æ¨¡å—é…ç½®ï¼Œåˆ†ç¦»åˆ°Capabilityåä¾¿äºç®¡ç†

### 5.3 åº”ä¿ç•™åœ¨NBTçš„å­—æ®µ

âœ… **å¿…é¡»æŒä¹…åŒ–çš„**:
```java
- upgrade_<id>           // æ¨¡å—ç­‰çº§ï¼ˆæ ¸å¿ƒæ•°æ®ï¼‰
- HasUpgrade_<id>        // å®‰è£…æ ‡è®°ï¼ˆé˜²ä½œå¼Šï¼‰
- OwnedMax_<id>          // æ‹¥æœ‰ä¸Šé™ï¼ˆé˜²ä½œå¼Šï¼‰
- Energy                 // èƒ½é‡å€¼ï¼ˆæ ¸å¿ƒæ•°æ®ï¼‰
- TotalEnergySaved       // ç´¯è®¡èŠ‚èƒ½ï¼ˆç»Ÿè®¡æ•°æ®ï¼‰
- Disabled_<id>          // ç¦ç”¨æ ‡è®°ï¼ˆç©å®¶é…ç½®ï¼‰
```

---

## ğŸ—‘ï¸ å…­ã€åº”åˆ é™¤/æ¸…ç†çš„å†—ä½™å­—æ®µ

### 6.1 å®Œå…¨å†—ä½™å­—æ®µ

âŒ **å¯ä»¥å®‰å…¨åˆ é™¤**:

```java
// 1. é‡å¤çš„å¤§å°å†™å˜ä½“
upgrade_flight_module     // æœ‰ upgrade_FLIGHT_MODULE
upgrade_energy_capacity   // æœ‰ upgrade_ENERGY_CAPACITY

// 2. åºŸå¼ƒçš„åˆ«å
æ‰€æœ‰WATERPROOFçš„4ä¸ªåˆ«åå†™å…¥åº”åˆå¹¶ä¸º1ä¸ª

// 3. æœªä½¿ç”¨çš„å­—æ®µ
NBTä¸­å¯èƒ½å­˜åœ¨çš„æµ‹è¯•å­—æ®µã€åºŸå¼ƒåŠŸèƒ½å­—æ®µ
```

### 6.2 åº”ç»Ÿä¸€çš„å­—æ®µ

âš ï¸ **éœ€è¦è¿ç§»ç»Ÿä¸€**:

```java
// æƒ©ç½šå­—æ®µåˆ†æ•£
PenaltyExpire_*          â†’ ç»Ÿä¸€åˆ° PenaltySystem Capability
PenaltyCap_*
PenaltyTier_*
PenaltyDebtFE_*
PenaltyDebtXP_*
```

### 6.3 å‘½åä¸è§„èŒƒå­—æ®µ

```java
// å‰ç¼€ä¸ç»Ÿä¸€
MechanicalCore.Wetness                  // åº”æ”¹ä¸º moremod.wetness
moremod.module.*                        // åº”ç»Ÿä¸€å‰ç¼€è§„èŒƒ
```

---

## âš ï¸ ä¸ƒã€ä¸åº”ç”± ItemMechanicalCore æ‰¿æ‹…çš„é€»è¾‘

### 7.1 äº‹ä»¶å¤„ç†é€»è¾‘

âŒ **ä¸åº”è¯¥åœ¨ ItemMechanicalCore ä¸­**:

```java
// è¿™äº›åº”è¯¥ç§»åˆ°ç‹¬ç«‹çš„äº‹ä»¶å¤„ç†å™¨
- é£è¡ŒæŒ‰é”®æ£€æµ‹         â†’ EventHandlerJetpack (å·²éƒ¨åˆ†ç§»å‡º)
- æ”»å‡»äº‹ä»¶å¤„ç†         â†’ CombatUpgradeManager
- ç§»åŠ¨æ£€æµ‹            â†’ EnergyUpgradeManager
- GUIäº¤äº’            â†’ MechanicalCoreGui
```

âœ… **å·²ç»æ­£ç¡®åˆ†ç¦»çš„**:
- `UpgradeEffectManager` - å‡çº§æ•ˆæœåº”ç”¨
- `EnergyDepletionManager` - èƒ½é‡è€—å°½å¤„ç†
- `WaterproofUpgrade` - é˜²æ°´é€»è¾‘
- `TemperatureControlEffect` - æ¸©åº¦æ§åˆ¶

### 7.2 GUIç›¸å…³é€»è¾‘

âŒ **åº”è¯¥ç§»å‡º**:

```java
ItemMechanicalCore ä¸­çš„:
- addInformation() æ–¹æ³•è¿‡äºå¤æ‚
- Tooltipæ˜¾ç¤ºé€»è¾‘åº”è¯¥ç®€åŒ–æˆ–ç§»åˆ°å®¢æˆ·ç«¯å·¥å…·ç±»
```

### 7.3 æ•°æ®ç»Ÿè®¡é€»è¾‘

âŒ **åº”è¯¥ç‹¬ç«‹**:

```java
// è¿™äº›åº”è¯¥åœ¨ç‹¬ç«‹çš„ç»Ÿè®¡ç®¡ç†å™¨ä¸­
- getTotalInstalledUpgrades()
- getTotalActiveUpgradeLevel()
- collectModuleStats()
```

### 7.4 èƒ½é‡è®¡ç®—é€»è¾‘

âŒ **åº”è¯¥ç§»åˆ°ä¸“é—¨çš„èƒ½é‡ç®¡ç†å™¨**:

```java
- calculateActivePassiveConsumption()    â†’ EnergyConsumptionManager
- applyBatteryGeneration()              â†’ EnergyGenerationManager
- handleInsufficientEnergy()            â†’ EnergyDepletionManager (éƒ¨åˆ†å·²ç§»)
```

---

## ğŸ“Š å…«ã€ä»£ç è†¨èƒ€åº¦é‡

### 8.1 æ–‡ä»¶å¤§å°ç»Ÿè®¡

```
ItemMechanicalCore.java           : ~2,130 è¡Œ  âš ï¸ è¿‡å¤§
ItemMechanicalCoreExtended.java   : ~800 è¡Œ    âœ… åˆç†
UpgradeEffectManager.java         : ~150 è¡Œ    âœ… åˆç†
EnergyUpgradeManager.java         : ~400 è¡Œ    âœ… åˆç†
```

### 8.2 æ–¹æ³•å¤æ‚åº¦

```java
// è¶…é•¿æ–¹æ³•ï¼ˆåº”è¯¥é‡æ„ï¼‰
ItemMechanicalCore.onWornTick()                  : ~50è¡Œ
ItemMechanicalCore.calculateActivePassiveConsumption() : ~70è¡Œ
ItemMechanicalCore.addInformation()              : ~100è¡Œ
```

### 8.3 NBTæ“ä½œåˆ†æ•£åº¦

```
NBTè¯»å–ä½ç½®: ~15ä¸ªç±»
NBTå†™å…¥ä½ç½®: ~12ä¸ªç±»
```
**é—®é¢˜**: NBTæ“ä½œè¿‡äºåˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†

---

## ğŸ¯ ä¹ã€é‡æ„å»ºè®®ä¼˜å…ˆçº§

### Priority 1: ç«‹å³æ‰§è¡Œ

1. **åˆ›å»º IPlayerModuleCapability**
   - è¿ç§»æ‰€æœ‰ç©å®¶ä¸´æ—¶çŠ¶æ€å­—æ®µ
   - ç§»é™¤ EntityData ä¸­çš„ä¸´æ—¶æ•°æ®

2. **ç»Ÿä¸€NBTå­—æ®µå‘½å**
   - æ¸…ç†å¤§å°å†™é‡å¤
   - åˆå¹¶åˆ«åå†™å…¥
   - ç»Ÿä¸€å‰ç¼€è§„èŒƒ

3. **åˆ†ç¦»äº‹ä»¶å¤„ç†é€»è¾‘**
   - å°†æ‰€æœ‰äº‹ä»¶ç›‘å¬ç§»å‡º ItemMechanicalCore
   - ä½¿ç”¨ä¸“é—¨çš„ EventHandler ç±»

### Priority 2: ä¸­æœŸé‡æ„

4. **åˆ›å»ºèƒ½é‡ç®¡ç†å™¨å±‚æ¬¡ç»“æ„**
   ```
   IEnergyManager (æ¥å£)
     â”œâ”€â”€ EnergyGenerationManager (å‘ç”µ)
     â”œâ”€â”€ EnergyConsumptionManager (æ¶ˆè€—)
     â””â”€â”€ EnergyDepletionManager (è€—å°½å¤„ç†)
   ```

5. **æ¨¡å—æ³¨å†Œç³»ç»Ÿä¼˜åŒ–**
   - ç»Ÿä¸€ ItemMechanicalCore.UpgradeType å’Œ UpgradeType.java
   - å»ºç«‹å•ä¸€æ³¨å†Œè¡¨
   - æ¶ˆé™¤æšä¸¾é‡å¤

6. **GUIé€»è¾‘åˆ†ç¦»**
   - Tooltipç”Ÿæˆç§»åˆ°ä¸“é—¨å·¥å…·ç±»
   - NBTæ˜¾ç¤ºé€»è¾‘ç®€åŒ–

### Priority 3: é•¿æœŸä¼˜åŒ–

7. **å¼•å…¥æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - attach/detach hooks
   - enable/disableç»Ÿä¸€æ¥å£

8. **æ•°æ®æŒä¹…åŒ–å±‚æŠ½è±¡**
   - åˆ›å»º IModuleDataStorage æ¥å£
   - NBTå’ŒCapabilityåŒå®ç°

9. **æ€§èƒ½ä¼˜åŒ–**
   - ç¼“å­˜è®¡ç®—ç»“æœ
   - å‡å°‘NBTè®¿é—®é¢‘ç‡
   - æ‰¹é‡æ›´æ–°æœºåˆ¶

---

## ğŸ“ åã€è¿ç§»è·¯çº¿å›¾

### Phase 1: å‡†å¤‡é˜¶æ®µ (1-2å¤©)
- âœ… å®Œæˆæœ¬æ–‡æ¡£
- â¬œ åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
- â¬œ å¤‡ä»½ç°æœ‰NBTæ•°æ®ç»“æ„

### Phase 2: Capabilityè¿ç§» (3-5å¤©)
- â¬œ å®ç° IPlayerModuleCapability
- â¬œ è¿ç§»ä¸´æ—¶çŠ¶æ€å­—æ®µ
- â¬œ å…¼å®¹æ€§æµ‹è¯•

### Phase 3: NBTæ¸…ç† (2-3å¤©)
- â¬œ ç»Ÿä¸€å­—æ®µå‘½å
- â¬œ åˆ é™¤å†—ä½™å­—æ®µ
- â¬œ è¿ç§»æŒ‡å—

### Phase 4: é€»è¾‘åˆ†ç¦» (5-7å¤©)
- â¬œ äº‹ä»¶å¤„ç†å™¨é‡æ„
- â¬œ èƒ½é‡ç®¡ç†å™¨æå–
- â¬œ GUIé€»è¾‘åˆ†ç¦»

### Phase 5: ä¼˜åŒ–ä¸æµ‹è¯• (3-5å¤©)
- â¬œ æ€§èƒ½ä¼˜åŒ–
- â¬œ å…¨é¢æµ‹è¯•
- â¬œ æ–‡æ¡£æ›´æ–°

---

## âš¡ åä¸€ã€å…³é”®é£é™©ä¸ç¼“è§£

### é£é™©1: NBTè¿ç§»å¯¼è‡´å­˜æ¡£ä¸å…¼å®¹
**ç¼“è§£æªæ–½**:
- ä¿ç•™å…¼å®¹æ€§è¯»å–é€»è¾‘
- é€æ­¥è¿ç§»ï¼Œä¸åˆ é™¤æ—§å­—æ®µ
- æä¾›è¿ç§»å·¥å…·

### é£é™©2: Capabilityç³»ç»Ÿæ€§èƒ½é—®é¢˜
**ç¼“è§£æªæ–½**:
- åªè¿ç§»å¿…è¦å­—æ®µ
- å®ç°å»¶è¿ŸåŠ è½½
- ç¼“å­˜æœºåˆ¶

### é£é™©3: é‡æ„å¼•å…¥æ–°Bug
**ç¼“è§£æªæ–½**:
- å®Œå–„çš„å•å…ƒæµ‹è¯•
- åˆ†é˜¶æ®µé‡æ„
- æ¯é˜¶æ®µç‹¬ç«‹æµ‹è¯•

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-01-22
**ä¸‹ä¸€æ­¥**: å¼€å§‹ Phase 1 å‡†å¤‡å·¥ä½œ
