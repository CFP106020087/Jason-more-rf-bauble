# äº‹ä»¶ç³»ç»Ÿæ¶æ„å›¾

## ğŸ“ ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸» Modï¼ˆä¸šåŠ¡å±‚ï¼‰                              â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  åªèƒ½ä¾èµ–ï¼š                                                           â”‚
â”‚    â€¢ IEvent, ICancellableEvent                                      â”‚
â”‚    â€¢ IEventBus                                                      â”‚
â”‚    â€¢ IEventListener, EventPriority                                  â”‚
â”‚    â€¢ EventService                                                   â”‚
â”‚                                                                      â”‚
â”‚  ä½¿ç”¨æ–¹å¼ï¼š                                                           â”‚
â”‚    IEventBus bus = EventService.getBus();                           â”‚
â”‚    bus.register(listener);                                          â”‚
â”‚    bus.post(event);                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                       [ä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å®ç°]
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API å±‚ï¼ˆæ¥å£å®šä¹‰å±‚ï¼‰                             â”‚
â”‚                   com.moremod.api.event                              â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  å…¬å…±æ¥å£ï¼š                                                           â”‚
â”‚    â€¢ IEvent                    - äº‹ä»¶åŸºç¡€æ¥å£                         â”‚
â”‚    â€¢ ICancellableEvent         - å¯å–æ¶ˆäº‹ä»¶æ¥å£                       â”‚
â”‚    â€¢ IEventBus                 - äº‹ä»¶æ€»çº¿æ¥å£ï¼ˆå”¯ä¸€å…¥å£ï¼‰              â”‚
â”‚    â€¢ IEventListener            - ç›‘å¬å™¨æ³¨è§£                           â”‚
â”‚    â€¢ EventPriority             - ä¼˜å…ˆçº§æšä¸¾                           â”‚
â”‚    â€¢ EventService              - Service Locatorï¼ˆæœåŠ¡å®šä½å™¨ï¼‰        â”‚
â”‚                                                                      â”‚
â”‚  å†…éƒ¨å®ç°ï¼š                                                           â”‚
â”‚    â€¢ NoOpEventBus              - No-Op å®ç°ï¼ˆFallbackï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                       [Service Locator åŠ¨æ€åŠ è½½]
                                  â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      é€šè¿‡åå°„å°è¯•åŠ è½½å®ç°ç±»             â”‚
            â”‚  Class.forName("EventBusProvider")   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                            â”‚
    æ‰¾åˆ°å®ç°ç±»                                   æ‰¾ä¸åˆ°å®ç°ç±»
        â”‚                                            â”‚
        â†“                                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EventBusImpl (çœŸå®)     â”‚              â”‚  NoOpEventBus (ç©ºæ“ä½œ)   â”‚
â”‚  âœ… æ³¨å†Œç›‘å¬å™¨            â”‚              â”‚  â­• æ‰€æœ‰æ“ä½œéƒ½æ˜¯ç©ºæ“ä½œ    â”‚
â”‚  âœ… è§¦å‘äº‹ä»¶              â”‚              â”‚  â­• ä¸ä¼šæŠ›å‡ºå¼‚å¸¸         â”‚
â”‚  âœ… ä¼˜å…ˆçº§æ’åº            â”‚              â”‚  â­• ä¸» mod æ­£å¸¸è¿è¡Œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®ç°å±‚ï¼ˆå¯æ‹”æ’ï¼Œå¯åˆ é™¤ï¼‰                            â”‚
â”‚                   com.moremod.eventhub                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  æ ¸å¿ƒå®ç°ï¼š                                                           â”‚
â”‚    â€¢ EventBusImpl              - äº‹ä»¶æ€»çº¿å®ç°                         â”‚
â”‚    â€¢ EventBusProvider          - å®ç°æ³¨å†Œå™¨                           â”‚
â”‚                                                                      â”‚
â”‚  å†…éƒ¨è¾…åŠ©ï¼š                                                           â”‚
â”‚    â€¢ ListenerMethod            - ç›‘å¬å™¨æ–¹æ³•å°è£…                       â”‚
â”‚    â€¢ EventScanner              - æ³¨è§£æ‰«æå™¨                           â”‚
â”‚                                                                      â”‚
â”‚  ç¤ºä¾‹ä»£ç ï¼š                                                           â”‚
â”‚    â€¢ PlayerLoginEvent          - ç¤ºä¾‹äº‹ä»¶                             â”‚
â”‚    â€¢ ExampleListener           - ç¤ºä¾‹ç›‘å¬å™¨                           â”‚
â”‚    â€¢ ExampleUsage              - ä½¿ç”¨ç¤ºä¾‹                             â”‚
â”‚                                                                      â”‚
â”‚  âš ï¸ æ­¤ç›®å½•å¯ä»¥å®Œå…¨åˆ é™¤ï¼Œä¸» mod ä¸ä¼šå´©æºƒï¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ é›¶è€¦åˆå®ç°åŸç†

### 1. Service Locator æ¨¡å¼

```java
// EventService.java
public static IEventBus getBus() {
    if (!initialized) {
        tryLoadImplementation();  // å°è¯•åŠ è½½å®ç°
    }
    return provider != null ? provider.provide() : NoOpEventBus.INSTANCE;
}

private static void tryLoadImplementation() {
    try {
        // é€šè¿‡åå°„åŠ è½½å®ç°ç±»
        Class<?> providerClass = Class.forName("com.moremod.eventhub.EventBusProvider");
        providerClass.getMethod("register").invoke(null);
        // âœ… åŠ è½½æˆåŠŸ â†’ ä½¿ç”¨ EventBusImpl
    } catch (ClassNotFoundException e) {
        // â­• åŠ è½½å¤±è´¥ â†’ ä½¿ç”¨ NoOpEventBus
    }
}
```

### 2. å¯æ‹”æ’æ€§éªŒè¯

```bash
# åœºæ™¯ 1ï¼ševenthub å­˜åœ¨
./gradlew build
âœ… EventService åŠ è½½ EventBusImpl
âœ… äº‹ä»¶ç³»ç»Ÿæ­£å¸¸å·¥ä½œ

# åœºæ™¯ 2ï¼šåˆ é™¤ eventhub
rm -rf src/main/java/com/moremod/eventhub
./gradlew build
âœ… EventService åŠ è½½ NoOpEventBus
âœ… ä¸» mod æ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œ
âœ… æ‰€æœ‰æ“ä½œå˜æˆç©ºæ“ä½œï¼ˆNo-Opï¼‰
```

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```
ä¸» Mod
  â”‚
  â””â”€â†’ ä¾èµ– API æ¥å£ï¼ˆIEventBus, IEvent, EventServiceï¼‰
        â”‚
        â”œâ”€â†’ EventServiceï¼ˆService Locatorï¼‰
        â”‚     â”‚
        â”‚     â”œâ”€â†’ å°è¯•åŠ è½½ EventBusProviderï¼ˆåå°„ï¼‰
        â”‚     â”‚     â”‚
        â”‚     â”‚     â”œâ”€â†’ æˆåŠŸ â†’ EventBusImpl
        â”‚     â”‚     â””â”€â†’ å¤±è´¥ â†’ NoOpEventBus
        â”‚     â”‚
        â”‚     â””â”€â†’ æ°¸è¿œä¸ä¼šè¿”å› null
        â”‚
        â””â”€â†’ NoOpEventBusï¼ˆFallback å®ç°ï¼‰
              â”‚
              â””â”€â†’ æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç©ºæ“ä½œ
```

## ğŸ¯ è®¾è®¡æ¨¡å¼åº”ç”¨

| æ¨¡å¼ | åº”ç”¨ | ç›®çš„ |
|------|------|------|
| **Service Locator** | EventService | åŠ¨æ€å®šä½å®ç°ï¼Œæ”¯æŒ fallback |
| **Lazy Initialization** | EventBusProvider | å»¶è¿Ÿåˆ›å»ºå•ä¾‹ï¼ŒèŠ‚çœèµ„æº |
| **Strategy Pattern** | IEventBus æ¥å£ | å¯ä»¥æ›¿æ¢ä¸åŒå®ç° |
| **Null Object Pattern** | NoOpEventBus | é¿å… null æ£€æŸ¥ï¼Œä¿è¯å¥å£®æ€§ |
| **Observer Pattern** | äº‹ä»¶ç›‘å¬æœºåˆ¶ | è§£è€¦äº‹ä»¶å‘å¸ƒè€…å’Œè®¢é˜…è€… |
| **Dependency Inversion** | ä¾èµ–æ¥å£è€Œéå®ç° | é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å— |

## ğŸ” é›¶è€¦åˆä¿è¯

### âœ… å…è®¸çš„ä¾èµ–

```java
// ä¸» mod åªèƒ½ import è¿™äº›
import com.moremod.api.event.IEvent;
import com.moremod.api.event.ICancellableEvent;
import com.moremod.api.event.IEventBus;
import com.moremod.api.event.IEventListener;
import com.moremod.api.event.EventPriority;
import com.moremod.api.event.EventService;
```

### âŒ ç¦æ­¢çš„ä¾èµ–

```java
// ä¸» mod ç»å¯¹ä¸èƒ½ import è¿™äº›
import com.moremod.eventhub.EventBusImpl;           // âŒ ç¦æ­¢
import com.moremod.eventhub.EventBusProvider;       // âŒ ç¦æ­¢
import com.moremod.eventhub.internal.*;             // âŒ ç¦æ­¢
```

### éªŒè¯æ–¹æ³•

```bash
# æ£€æŸ¥ä¸» mod æ˜¯å¦æœ‰éæ³•ä¾èµ–
grep -r "import com.moremod.eventhub" src/main/java/com/moremod/*.java
# åº”è¯¥æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **äº‹ä»¶ç±»å‹æ˜ å°„**ï¼šO(1) æŸ¥æ‰¾ç›‘å¬å™¨
2. **ä¼˜å…ˆçº§æ’åº**ï¼šåªåœ¨æ³¨å†Œæ—¶æ’åºä¸€æ¬¡
3. **CopyOnWriteArrayList**ï¼šè¯»å¤šå†™å°‘åœºæ™¯ä¼˜åŒ–
4. **çº¿ç¨‹å®‰å…¨æ— é”**ï¼šä½¿ç”¨å¹¶å‘é›†åˆï¼Œé¿å…é”ç«äº‰
5. **æ‡’åŠ è½½**ï¼šåªåœ¨éœ€è¦æ—¶åˆ›å»ºå®ä¾‹

## ğŸ›¡ï¸ å¼‚å¸¸éš”ç¦»

```java
// å•ä¸ªç›‘å¬å™¨å¼‚å¸¸ä¸å½±å“å…¶ä»–ç›‘å¬å™¨
for (ListenerMethod listener : listeners) {
    try {
        listener.invoke(event);
    } catch (Exception e) {
        // è®°å½•é”™è¯¯ä½†ç»§ç»­æ‰§è¡Œ
        System.err.println("Error in listener: " + listener);
    }
}
```

## ğŸ“ æ€»ç»“

è¿™ä¸ªäº‹ä»¶ç³»ç»ŸçœŸæ­£åšåˆ°äº†ï¼š
- âœ… å®Œå…¨å¯æ‹”æ’ï¼ˆåˆ é™¤ä¸å´©æºƒï¼‰
- âœ… é›¶è€¦åˆï¼ˆåªä¾èµ–æ¥å£ï¼‰
- âœ… ç‹¬ç«‹è¿è¡Œï¼ˆä¸ä¾èµ– Forgeï¼‰
- âœ… é«˜æ€§èƒ½ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
- âœ… æ˜“äºä½¿ç”¨ï¼ˆæ³¨è§£é©±åŠ¨ï¼‰
- âœ… å¥å£®æ€§å¼ºï¼ˆå¼‚å¸¸éš”ç¦»ï¼‰
