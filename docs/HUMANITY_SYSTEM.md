# 人性值光谱系统 (Humanity Spectrum System)

> Minecraft 1.12.2 Forge Mod - 完整系统文档

---

## 目录

1. [系统概述](#1-系统概述)
2. [人性值等级与效果](#2-人性值等级与效果)
3. [协议系统](#3-协议系统)
4. [存在崩解](#4-存在崩解)
5. [升格路线](#5-升格路线)
6. [破碎遗物系统](#6-破碎遗物系统)
7. [人性值变化机制](#7-人性值变化机制)
8. [HUD显示系统](#8-hud显示系统)
9. [配置选项](#9-配置选项)
10. [技术架构](#10-技术架构)

---

## 1. 系统概述

人性值光谱系统是一个追踪玩家"人性"程度的核心机制，范围从 **0%** 到 **100%**。

- **初始人性值**: 75%
- **系统激活**: 安装首个机械核心时自动激活
- **影响范围**: 生命值、NPC交互、设备使用、战斗能力

### 核心文件结构

```
system/humanity/
├── IHumanityData.java          # 数据接口
├── HumanityDataImpl.java       # 数据实现 + NBT序列化
├── HumanityCapabilityHandler   # 能力系统注册
├── HumanitySpectrumSystem      # 核心逻辑计算
├── HumanityEventHandler        # 事件处理
├── HumanityEffectsManager      # 效果应用
└── AscensionRoute.java         # 升格路线枚举
```

---

## 2. 人性值等级与效果

### 2.1 生命值减少 (非升格状态)

| 人性值范围 | HP减少 | 状态名称 |
|-----------|--------|---------|
| > 40% | 0% | 正常 |
| 25% - 40% | -15% | 异常协议 |
| 10% - 25% | -30% | 深度异化 |
| < 10% | -50% | 临界崩解 |

### 2.2 NPC交互等级

| 人性值 | 交互等级 | 价格倍率 | 说明 |
|--------|---------|---------|------|
| ≥ 80% | 信任 (TRUSTED) | 0.85x | -15% 折扣 |
| 60% - 80% | 正常 (NORMAL) | 1.0x | 标准交易 |
| 40% - 60% | 怀疑 (SUSPICIOUS) | 1.5x | +50% 加价 |
| 25% - 40% | 敌对 (HOSTILE) | 拒绝 | 无法交易 |
| < 25% | 无视 (INVISIBLE) | - | 完全无法交互 |

### 2.3 生物档案槽位

- **计算公式**: `floor(humanity / 10)`
- **100%人性**: 10个槽位
- **50%人性**: 5个槽位
- **<40%人性**: 0个槽位 (无法使用档案)

### 2.4 链结站使用

- **需求**: ≥ 60% 人性值
- **破碎之神**: 禁止使用
- **Mekhane合成人**: 始终可用

---

## 3. 协议系统

### 3.1 猎人协议 (≥ 60% 人性)

**"精准分析，高效猎杀"**

- 精准生物样本采集
- 基于档案的伤害加成
- 完整的生物档案系统
- 最大槽位利用

### 3.2 灰域 (40% - 60% 人性)

**"量子叠加态 - 不稳定"**

- 两种协议效果混合
- 致命伤害可能触发量子坍缩
- 半激活异常场
- 不可预测的状态波动

### 3.3 异常协议 (25% - 40% 人性)

**"你开始偏离人类的轨道"**

- 异常场激活 (伤害周围实体)
- 治疗效果降低
- 存在锚定 (防止跌破10%)
- 视觉扭曲效果

### 3.4 深度异化 (10% - 25% 人性)

**"深渊在回望"**

- 增强的异常场效果
- 扭曲脉冲触发概率提高
- 凋零光环 (可配置)
- 严重的治疗削减

### 3.5 临界崩解 (< 10% 人性)

**"存在即将消散"**

| 能力 | 数值 | 说明 |
|-----|------|------|
| 无痛麻木 | 35% | 伤害优先转移至要害 |
| 要害转移倍率 | 1.5x | 肢体伤害50%转移至躯干/头部 |
| 范围伤害 | ±3格 | 30%原伤害扩散 |
| 扭曲脉冲 | 极高概率 | 自动反击 |

---

## 4. 存在崩解

### 触发条件
人性值降至 **0%**

### 崩解阶段 (60秒)

```
┌─────────────────────────────────────────┐
│  【崩解中】剩余 Xs                        │
│                                         │
│  • 所有攻击伤害 ×2                        │
│  • 每次攻击对自身造成 5% MaxHP 伤害        │
│  • 必须存活60秒                          │
└─────────────────────────────────────────┘
```

### 结果

| 结果 | 效果 |
|------|------|
| **存活** | 人性回弹至 50% + 存在锚定 (24小时) |
| **死亡** | 人性重置为 50% |

### 存在锚定

- **持续时间**: 24小时 (可配置)
- **效果**: 人性值不会跌破 10%
- **HUD标识**: [锚定中] 洋红色文字

---

## 5. 升格路线

### 5.1 Mekhane 合成人

**"机械服务于人类精神"**

#### 升格条件
- 人性值 ≥ 80%
- 模块安装率 ≥ 90%
- 机械稳定度 ≥ 90%

#### 能力

| 能力 | 效果 |
|------|------|
| 协同完美 | 无HP减少，链结站可用 |
| 逻辑之盾 | 免疫混乱效果 |
| 精准计算 | 高暴击率 |
| 规则感知 | 特殊对话选项 |

#### 维护机制
- **人性行为分数** (0-100, 默认100)
- 分数 < 30: 能力减弱
- 通过人道行为提升分数

---

### 5.2 破碎之神

**"齿轮转动，但不知为何而转"**

#### 升格条件

| 条件 | 数值 |
|------|------|
| 人性值上限 | ≤ 5% |
| 模块数量 | ≥ 20 |
| 低人性累计时间 | ≥ 1800秒 (30分钟) |
| 低人性阈值 | 持续 < 15% |

#### 代价

- ❌ 所有药水效果无效
- ❌ 无法使用链结站
- ❌ NPC完全无视你
- ❌ 猎人协议禁用

#### 能力

| 能力 | 效果 |
|------|------|
| **关机模式** | 濒死时进入20秒无敌 |
| **畸变脉冲** | 受重击自动反击 (范围10格) |
| **破碎遗物** | 解锁6件终局饰品 |

#### 运行值系统
- **范围**: 0-100
- **低于20**: 持续受伤
- **维护**: 通过战斗/操作恢复

---

## 6. 破碎遗物系统

> 全部6件遗物在升格为破碎之神后**强制装备且无法卸下**

### 6.1 破碎_心核 (护符槽)

**"极限压缩的生命容器"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 生命压缩 | 10 HP | 最大生命固定为10 |
| 完全吸血 | 100% | 伤害全额转化为治疗 |
| 吸血溢出 | 最多20 | 转化为吸收之心 |
| 狂战士 | ×1~×5 | 血量越低伤害越高 |
| 不朽 | 1 HP | 永不低于1血 |

**狂战士计算**: `倍率 = 5 - 4 × (当前HP / 最大HP)`

---

### 6.2 破碎_臂 (戒指槽)

**"机械之臂，粉碎一切防御"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 伤害倍率 | ×2 | 基础伤害翻倍 |
| 暴击伤害 | ×3 | 必定暴击 |
| 攻击距离 | +3格 | 近战延伸 |
| 护甲粉碎场 | 10格 | 范围内敌人护甲归零 |

**总伤害倍率**: ×6 (基础×2 × 暴击×3)

---

### 6.3 破碎_手 (戒指槽)

**"无尽的攻击节奏"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 攻击速度 | ×3 | 三倍攻速 |
| 近战伤害 | +100% | 额外近战加成 |
| 冷却重置 | 启用 | 每次攻击后重置冷却 |

---

### 6.4 破碎_枷锁 (腰带槽)

**"时空在此凝固"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 时停领域 | 10格 | 范围内敌人无法移动 |
| 混乱光环 | 20tick | 敌人视角随机旋转 |
| 伤害减免 | -50% | 受到伤害减半 |
| 自身减速 | -30% | 代价：移速降低 |

---

### 6.5 破碎_投影 (饰品槽)

**"幻影与实体的界限"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 幻影打击 | +100% | 额外真实伤害 |
| 斩杀执行 | <50% HP | 目标低于阈值直接击杀 |
| 无视无敌帧 | 启用 | 伤害无视无敌时间 |

---

### 6.6 破碎_终结 (胸甲槽) - 顶点遗物

**"终极力量，纯粹增益"**

| 能力 | 数值 | 说明 |
|------|------|------|
| 伤害倍增 | ×2 | 全局伤害翻倍 |
| 死亡收割 | +5 HP | 击杀恢复生命 |
| 吸收获取 | +10 | 击杀获得吸收之心 |

> ⚠️ 此遗物无任何负面效果

---

### 破碎遗物伤害计算汇总

```
基础伤害 × 2 (破碎_臂)
        × 3 (破碎_臂暴击)
        × 2 (破碎_终结)
        × 1~5 (破碎_心核狂战士)
        + 100% 真伤 (破碎_投影)

理论最大倍率: ×60 + 100%真伤 (1HP狂战士状态)
```

---

## 7. 人性值变化机制

### 7.1 人性值消耗

| 行为 | 消耗量 | 说明 |
|------|--------|------|
| 虚空发生器 | -0.5 | 单次使用 |
| 裂隙脉冲 | -1.0 | 单次使用 |
| 相位转移 | -0.4 | 单次使用 |
| 维度跳跃 | -1.5 | 单次使用 |
| 超频运行 | -0.01/秒 | 持续 |
| 睡眠剥夺 | -0.004/秒 | 72分钟不睡觉后 |
| 异常维度 | -0.006/秒 | 在特殊维度 |
| 击杀被动生物 | -0.1 | 单次 |
| 击杀村民 | -0.5 | 单次 |
| 战斗状态 | -0.02/秒 | <50%人性时 |

### 7.2 人性值恢复

| 行为 | 恢复量 | 上限 |
|------|--------|------|
| 睡眠 | +1.5 | 85% |
| 熟食 | +0.05 | - |
| 精致食物 | +0.15 | - |
| 金质食物 | +0.3 | - |
| 阳光照射 | +0.002/秒 | - |
| 村民交易 | +0.3 | - |
| 收获作物 | +0.05 | - |
| 喂养动物 | +0.05 | - |

---

## 8. HUD显示系统

### 8.1 人性值条

**位置**: 左上角 (偏移可配置)

```
┌──────────────────────────────────────┐
│ [████████████████░░░░] 80%           │
│ 猎人协议                              │
└──────────────────────────────────────┘
```

### 8.2 颜色方案

| 人性值 | 颜色 | 色值 |
|--------|------|------|
| ≥ 75% | 淡蓝 | 0xFFAADDFF |
| 60-75% | 淡青 | 0xFFBBDDEE |
| 50-60% | 黄白 | 0xFFFFFFAA |
| 40-50% | 淡紫 | 0xFFEEBBFF |
| 25-40% | 紫色 | 0xFFDD88FF |
| 10-25% | 深紫 | 0xFFAA44DD |
| <10% | 暗紫 | 0xFF8800AA |
| 破碎之神 | 稳定紫 | 0xFF5500AA |

### 8.3 状态标签

| 人性值 | 显示文字 | 颜色 |
|--------|---------|------|
| ≥ 80% | 猎人协议 | 青色 |
| 60-80% | 高人性 | 绿色 |
| 40-60% | 灰域 | 黄色 |
| 25-40% | 异常协议 | 紫色 |
| 10-25% | 深度异常 | 深紫 |
| <10% | 临界崩解 | 红色 |
| 破碎之神 | 破碎之神 | 暗紫 |

### 8.4 特殊显示

- **崩解倒计时**: `【崩解中】 Xs` (红色)
- **分析进度**: `分析: [实体名] [%]`
- **锚定状态**: `[锚定中]` (洋红)
- **低人性抖动**: <10%时随机±1像素偏移

---

## 9. 配置选项

### 9.1 主配置 (HumanityConfig)

```properties
# 系统开关
enableHumanitySystem = true
initialHumanity = 75.0
dissolutionDuration = 60  # 秒
existenceAnchorDuration = 24  # 小时

# HUD显示
showHumanityHUD = true
enableVisualDistortion = true
hudXOffset = 10
hudYOffset = 10

# 阈值设置
synergyStationThreshold = 60.0
npcInteractionThreshold = 25.0
noTradeThreshold = 10.0

# 极低人性
extremeLowHumanityCritChance = 0.35
extremeLowHumanityCritMultiplier = 1.5
extremeLowHumanityAoERange = 3.0
extremeLowHumanityAoEDamageRatio = 0.3
```

### 9.2 破碎之神配置 (BrokenGodConfig)

```properties
# 升格条件
ascensionHumanityThreshold = 5.0
requiredModuleCount = 20
requiredLowHumanitySeconds = 1800
lowHumanityThreshold = 15.0

# 关机模式
shutdownTicks = 400  # 20秒
restartHeal = 1.0
invulnerableDuringShutdown = true

# 畸变脉冲
pulseTriggerDamage = 20.0
pulseRange = 10.0
pulseDamage = 8.0
pulseCooldown = 80
```

### 9.3 破碎遗物配置 (BrokenRelicConfig)

```properties
# 心核
heartcoreCompressedHP = 10.0
heartcoreLifestealRatio = 1.0
heartcoreMaxAbsorption = 20.0
heartcoreBerserkerMaxMultiplier = 5.0

# 臂
armDamageMultiplier = 2.0
armCritMultiplier = 3.0
armArmorShredRange = 10.0
armRangeExtension = 3.0

# 手
handSpeedMultiplier = 3.0
handMeleeDamageBonus = 1.0
handResetCooldown = true

# 枷锁
shacklesAuraRange = 10.0
shacklesSelfSlow = 0.3
shacklesDamageReduction = 0.5

# 投影
projectionTrueDamageRatio = 1.0
projectionExecuteThreshold = 0.5

# 终结
terminusDamageMultiplier = 2.0
terminusKillHeal = 5.0
terminusKillAbsorption = 10.0
```

---

## 10. 技术架构

### 数据流程图

```
┌─────────────────────────────────────────────────────────┐
│               IHumanityData Interface                    │
│  ├─ humanity: float (0-100)                             │
│  ├─ systemActive: boolean                                │
│  ├─ dissolutionActive: boolean                          │
│  ├─ existenceAnchorUntil: long                          │
│  ├─ ascensionRoute: AscensionRoute                      │
│  ├─ lowHumanityTicks: long                              │
│  └─ operationValue: float (破碎之神)                     │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│           HumanityCapabilityHandler                      │
│  • 注册 Capability 到 Forge                              │
│  • 附加到 EntityPlayer                                   │
│  • 处理死亡/重生数据保留                                  │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│              HumanityEventHandler                        │
│  • PlayerTick: 人性值变化, MaxHP更新                     │
│  • LivingHurt: 伤害修正, 范围伤害                        │
│  • Sleep: 恢复与剥夺                                     │
│  • Death: 崩解处理                                       │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│             HumanityEffectsManager                       │
│  • MaxHP 属性修改器                                      │
│  • 药水免疫 (破碎之神)                                   │
│  • NPC交互等级判定                                       │
│  • 链结站访问控制                                        │
│  • 升格检查与执行                                        │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│                  Client Side                             │
│  ├─ HumanityHUD: 人性条, 状态, 倒计时                    │
│  └─ SmartRejectionGuide: 里程碑, 详细状态                │
└─────────────────────────────────────────────────────────┘
```

### 升格判定流程

```
每Tick检查:
    if (route == NONE):
        if (humanity <= 5 && lowHumanityTime >= 30min && modules >= 20):
            → 升格为 BROKEN_GOD
            → 强制装备6件破碎遗物
            → 人性永久锁定为0

        elif (humanity >= 80 && modules >= 90% && stability >= 90%):
            → 升格为 MEKHANE_SYNTHETIC
            → 解锁合成人能力
```

### 事件优先级

```
LivingHurtEvent:
  HIGHEST: BrokenGodEventHandler (关机模式检测)
  HIGH:    BrokenRelicEventHandler (伤害减免)
  LOWEST:  BrokenRelicEventHandler (伤害倍率)

LivingDamageEvent:
  LOWEST:  BrokenRelicEventHandler (真伤计算)
```

---

## 附录: 快速参考

### 人性值速查表

| 人性值 | 状态 | HP | NPC | 链结站 | 档案槽 |
|--------|------|-----|-----|--------|--------|
| 80%+ | 猎人协议 | 100% | 折扣 | ✓ | 8-10 |
| 60-80% | 高人性 | 100% | 正常 | ✓ | 6-7 |
| 40-60% | 灰域 | 100% | 加价 | ✗ | 4-5 |
| 25-40% | 异常协议 | 85% | 拒绝 | ✗ | 2-3 |
| 10-25% | 深度异化 | 70% | 无视 | ✗ | 1 |
| <10% | 临界崩解 | 50% | 无视 | ✗ | 0 |
| 0% | 破碎之神 | 10* | 无视 | ✗ | 0 |

*破碎之神HP由心核遗物固定为10

### 破碎遗物总览

| 遗物 | 槽位 | 核心效果 | 代价 |
|------|------|---------|------|
| 心核 | 护符 | 吸血×100%, 狂战士×5 | HP固定10 |
| 臂 | 戒指 | 伤害×6, 护甲粉碎 | 无 |
| 手 | 戒指 | 攻速×3, 无冷却 | 无 |
| 枷锁 | 腰带 | 时停, 减伤50% | 自身减速30% |
| 投影 | 饰品 | 真伤+100%, 斩杀 | 无 |
| 终结 | 胸甲 | 伤害×2, 击杀回复 | 无 |

---

*文档版本: 1.0*
*最后更新: 2025-11-28*
